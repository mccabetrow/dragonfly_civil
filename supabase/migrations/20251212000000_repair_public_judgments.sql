-- Repair migration: Create public.judgments if missing
-- This addresses schema drift where early migrations were marked as applied but didn't execute
-- Create the judgments table (from 0030_judgments_table.sql) if it doesn't exist
CREATE TABLE IF NOT EXISTS public.judgments (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    -- Data from the court file
    case_number TEXT,
    plaintiff_name TEXT,
    defendant_name TEXT,
    judgment_amount NUMERIC(10, 2),
    entry_date DATE,
    -- Source tracking
    source_file TEXT,
    CONSTRAINT unique_case_number UNIQUE (case_number)
);
-- Create index if not exists (PostgreSQL 9.5+)
CREATE INDEX IF NOT EXISTS idx_defendant_name ON public.judgments (defendant_name);
-- Grant appropriate permissions for the API
GRANT SELECT,
    INSERT,
    UPDATE ON public.judgments TO anon,
    authenticated;
GRANT USAGE,
    SELECT ON SEQUENCE public.judgments_id_seq TO anon,
    authenticated;
-- Notify PostgREST to reload schema
NOTIFY pgrst,
'reload schema';